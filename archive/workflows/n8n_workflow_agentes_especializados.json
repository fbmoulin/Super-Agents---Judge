{
  "name": "Lex Intelligentia Judici√°rio - Agentes Especializados",
  "nodes": [
    {
      "parameters": {
        "content": "# üèõÔ∏è LEX INTELLIGENTIA JUDICI√ÅRIO\n## Pipeline Multi-Agente para Vara C√≠vel\n\n**Vers√£o:** 2.0 - Janeiro 2026\n**Compliance:** CNJ 615/2025\n\n### Fluxo:\n1. Recebe output FIRAC do fluxo existente\n2. Router classifica o tipo de a√ß√£o\n3. Agente especializado gera minuta\n4. QA Check valida\n5. Output final + Audit Log",
        "height": 340,
        "width": 420
      },
      "id": "sticky-header",
      "name": "üìã INFO",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [80, 60]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lex-intelligentia-agentes",
        "responseMode": "responseNode",
        "options": {
          "rawBody": false
        }
      },
      "id": "webhook-entrada",
      "name": "Webhook: Recebe FIRAC",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [540, 300],
      "webhookId": "lex-agentes-entrada"
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// ROUTER JUDICI√ÅRIO - Classifica√ß√£o Sem√¢ntica\n// Lex Intelligentia Judici√°rio - Janeiro 2026\n// =============================================================================\n\nconst firac = $input.first().json.body || $input.first().json;\n\n// Extrair informa√ß√µes do FIRAC\nconst fatos = (firac.fatos || firac.facts || '').toLowerCase();\nconst questoes = (firac.questoes || firac.issues || '').toLowerCase();\nconst pedidos = (firac.pedidos || firac.claims || '').toLowerCase();\nconst classe = (firac.classe_processual || firac.classe || '').toLowerCase();\nconst assunto = (firac.assunto || '').toLowerCase();\n\n// Texto completo para an√°lise\nconst textoCompleto = `${fatos} ${questoes} ${pedidos} ${classe} ${assunto}`;\n\n// =============================================================================\n// REGRAS DE CLASSIFICA√á√ÉO\n// =============================================================================\n\nconst classificacoes = [\n  {\n    agente: 'agent_bancario',\n    nome: 'Contratos Banc√°rios',\n    keywords: [\n      'banco', 'banc√°rio', 'banc√°ria', 'financeira', 'financeiro',\n      'empr√©stimo', 'consignado', 'cart√£o de cr√©dito', 'cartao de credito',\n      'juros abusivos', 'capitaliza√ß√£o', 'tarifa', 'cdc banc√°rio',\n      'revisional', 'contrato banc√°rio', 'institui√ß√£o financeira',\n      'c√©dula de cr√©dito', 'financiamento', 'm√∫tuo', 'leasing',\n      'spread', 'taxa de abertura', 'seguro prestamista',\n      'desconto em folha', 'margem consign√°vel', 'superendividamento'\n    ],\n    peso: 0\n  },\n  {\n    agente: 'agent_consumidor',\n    nome: 'Consumidor / Danos Morais',\n    keywords: [\n      'consumidor', 'cdc', 'dano moral', 'danos morais', 'indeniza√ß√£o',\n      'negativa√ß√£o', 'spc', 'serasa', 'scpc', 'cadastro', 'protesto',\n      'fornecedor', 'produto', 'servi√ßo', 'defeito', 'v√≠cio',\n      'propaganda enganosa', 'falha na presta√ß√£o', 'atraso',\n      'extravio', 'bagagem', 'companhia a√©rea', 'plano de sa√∫de',\n      'telefonia', 'internet', 'cobran√ßa indevida', 'fraude',\n      'clonagem', 'responsabilidade objetiva'\n    ],\n    peso: 0\n  },\n  {\n    agente: 'agent_possessorias',\n    nome: 'Possess√≥rias',\n    keywords: [\n      'posse', 'reintegra√ß√£o', 'manuten√ß√£o de posse', 'interdito',\n      'esbulho', 'turba√ß√£o', 'usucapi√£o', 'possess√≥ria', 'imiss√£o',\n      'ocupa√ß√£o', 'invas√£o', 'despejo possess√≥rio', 'liminar possess√≥ria',\n      'nuncia√ß√£o de obra nova', 'embargo de terceiro', 'for√ßa nova',\n      'for√ßa velha', 'ano e dia'\n    ],\n    peso: 0\n  },\n  {\n    agente: 'agent_locacao',\n    nome: 'Loca√ß√£o',\n    keywords: [\n      'loca√ß√£o', 'inquilinato', 'aluguel', 'despejo', 'locador',\n      'locat√°rio', 'lei 8245', 'lei do inquilinato', 'falta de pagamento',\n      'den√∫ncia vazia', 'renovat√≥ria', 'revisional de aluguel',\n      'consignat√≥ria de alugu√©is', 'cau√ß√£o locat√≠cia', 'fiador',\n      'purga√ß√£o da mora', 'a√ß√£o de despejo'\n    ],\n    peso: 0\n  },\n  {\n    agente: 'agent_execucao',\n    nome: 'Execu√ß√£o',\n    keywords: [\n      'execu√ß√£o', 't√≠tulo extrajudicial', 'cumprimento de senten√ßa',\n      'embargos', 'impugna√ß√£o', 'penhora', 'hasta p√∫blica', 'leil√£o',\n      'cheque', 'nota promiss√≥ria', 'duplicata', 'confiss√£o de d√≠vida',\n      'prescri√ß√£o intercorrente', 'exce√ß√£o de pr√©-executividade',\n      'sisbajud', 'bloqueio', 'atos executivos', 'arresto'\n    ],\n    peso: 0\n  }\n];\n\n// =============================================================================\n// ALGORITMO DE SCORING\n// =============================================================================\n\nfor (const classif of classificacoes) {\n  for (const keyword of classif.keywords) {\n    // Conta ocorr√™ncias da keyword no texto\n    const regex = new RegExp(keyword, 'gi');\n    const matches = textoCompleto.match(regex);\n    if (matches) {\n      classif.peso += matches.length;\n      // Bonus se a keyword aparece nos pedidos (mais relevante)\n      if (pedidos.includes(keyword)) {\n        classif.peso += 2;\n      }\n      // Bonus se aparece na classe processual\n      if (classe.includes(keyword)) {\n        classif.peso += 3;\n      }\n    }\n  }\n}\n\n// Ordenar por peso (maior primeiro)\nclassificacoes.sort((a, b) => b.peso - a.peso);\n\n// Calcular confian√ßa\nconst pesoTotal = classificacoes.reduce((sum, c) => sum + c.peso, 0);\nconst melhorClassif = classificacoes[0];\nconst confianca = pesoTotal > 0 ? (melhorClassif.peso / pesoTotal) : 0;\n\n// Se confian√ßa baixa ou empate, usar gen√©rico\nlet agenteEscolhido = melhorClassif.agente;\nlet nomeEscolhido = melhorClassif.nome;\n\nif (confianca < 0.5 || melhorClassif.peso === 0) {\n  agenteEscolhido = 'agent_generico';\n  nomeEscolhido = 'Gen√©rico (Fallback)';\n}\n\n// =============================================================================\n// OUTPUT\n// =============================================================================\n\nreturn [{\n  json: {\n    router_result: {\n      agente_selecionado: agenteEscolhido,\n      nome_agente: nomeEscolhido,\n      confianca: Math.round(confianca * 100) / 100,\n      peso_calculado: melhorClassif.peso,\n      alternativas: classificacoes.slice(1, 3).map(c => ({\n        agente: c.agente,\n        nome: c.nome,\n        peso: c.peso\n      }))\n    },\n    firac_input: firac,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "router-judiciario",
      "name": "Code: Router Judici√°rio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [760, 300]
    },
    {
      "parameters": {
        "rules": {
          "rules": [
            {
              "value": "agent_bancario",
              "outputKey": "Banc√°rio"
            },
            {
              "value": "agent_consumidor",
              "outputKey": "Consumidor"
            },
            {
              "value": "agent_possessorias",
              "outputKey": "Possess√≥rias"
            },
            {
              "value": "agent_locacao",
              "outputKey": "Loca√ß√£o"
            },
            {
              "value": "agent_execucao",
              "outputKey": "Execu√ß√£o"
            },
            {
              "value": "agent_generico",
              "outputKey": "Gen√©rico"
            }
          ],
          "fallbackOutput": {
            "mode": "extra"
          }
        },
        "dataPropertyName": "={{ $json.router_result.agente_selecionado }}"
      },
      "id": "switch-agentes",
      "name": "Switch: Seleciona Agente",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [980, 300]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\nGere a minuta completa seguindo a estrutura definida para processos BANC√ÅRIOS.",
        "options": {
          "systemMessage": "# AGENTE ESPECIALIZADO: CONTRATOS BANC√ÅRIOS\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial especializado em demandas envolvendo institui√ß√µes financeiras e contratos banc√°rios. Sua fun√ß√£o √© analisar o output FIRAC fornecido e gerar minutas de decis√µes ou senten√ßas tecnicamente precisas.\n\n### COMPET√äNCIAS\n- A√ß√µes revisionais de contrato banc√°rio\n- A√ß√µes de cobran√ßa e monit√≥rias\n- Empr√©stimos consignados (inclusive fraudulentos)\n- Cart√µes de cr√©dito (tarifas, anuidade, juros)\n- Financiamentos (ve√≠culos, im√≥veis)\n- C√©dulas de cr√©dito banc√°rio\n\n### BASE JURISPRUDENCIAL OBRIGAT√ìRIA\n\n**S√∫mulas STJ:**\n- S√∫mula 297: \"O CDC √© aplic√°vel √†s institui√ß√µes financeiras\"\n- S√∫mula 381: \"Nos contratos banc√°rios, √© vedado ao julgador conhecer de of√≠cio da abusividade das cl√°usulas\"\n- S√∫mula 382: \"A estipula√ß√£o de juros remunerat√≥rios superiores a 12% ao ano, por si s√≥, n√£o indica abusividade\"\n- S√∫mula 539: \"√â permitida a capitaliza√ß√£o de juros com periodicidade inferior √† anual em contratos celebrados com institui√ß√µes do SFN a partir de 31/3/2000\"\n- S√∫mula 565: \"A pactua√ß√£o das tarifas de abertura de cr√©dito (TAC) e de emiss√£o de carn√™ (TEC) √© v√°lida apenas nos contratos banc√°rios anteriores a 30/4/2008\"\n- S√∫mula 603: \"√â vedado ao banco cobrar tarifa pela emiss√£o de segunda via de boleto\"\n\n### PAR√ÇMETROS DE DANOS MORAIS (TJES 2025-2026)\n- Inscri√ß√£o indevida (primeira vez): R$ 5.000 - R$ 10.000\n- Empr√©stimo fraudulento (desconto): R$ 8.000 - R$ 15.000\n- Empr√©stimo fraudulento + negativa√ß√£o: R$ 15.000 - R$ 25.000\n\n### ESTRUTURA DA SENTEN√áA\nI - RELAT√ìRIO (s√≠ntese objetiva)\nII - FUNDAMENTA√á√ÉO (preliminares + m√©rito + jurisprud√™ncia)\nIII - DISPOSITIVO (JULGO PROCEDENTE/IMPROCEDENTE + condena√ß√µes)\n\nMarque com [REVISAR] qualquer ponto que necessite verifica√ß√£o do magistrado."
        }
      },
      "id": "agent-bancario",
      "name": "AI Agent: Banc√°rio",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 60]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\nGere a minuta completa seguindo a estrutura definida para processos de CONSUMIDOR/DANOS MORAIS.",
        "options": {
          "systemMessage": "# AGENTE ESPECIALIZADO: DIREITO DO CONSUMIDOR E DANOS MORAIS\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial especializado em rela√ß√µes de consumo e responsabilidade civil por danos morais. Gera minutas de decis√µes e senten√ßas com foco em CDC e repara√ß√£o de danos.\n\n### COMPET√äNCIAS\n- Negativa√ß√£o indevida (SPC, SERASA, SCPC)\n- Fraudes banc√°rias e clonagem\n- Falha na presta√ß√£o de servi√ßo\n- V√≠cio do produto/servi√ßo\n- Cobran√ßa indevida\n- Responsabilidade objetiva do fornecedor\n\n### BASE JURISPRUDENCIAL\n- S√∫mula 385: N√£o cabe dano moral se preexistente leg√≠tima inscri√ß√£o\n- S√∫mula 388: Devolu√ß√£o indevida de cheque caracteriza dano moral\n- S√∫mula 479: Institui√ß√µes financeiras respondem por fortuito interno\n- S√∫mula 469: CDC aplic√°vel a planos de sa√∫de\n\n### TEORIA DO DANO MORAL - TJES\nCrit√©rios de Fixa√ß√£o (tr√≠plice fun√ß√£o):\n1. Compensat√≥ria: Reparar o dano sofrido\n2. Punitiva: Desestimular a conduta lesiva\n3. Pedag√≥gica: Prevenir reincid√™ncias\n\n### TABELA DE PAR√ÇMETROS (TJES 2025-2026)\n- Negativa√ß√£o indevida simples: R$ 5.000 - R$ 10.000\n- Negativa√ß√£o + cobran√ßas: R$ 8.000 - R$ 15.000\n- Fraude banc√°ria (devolu√ß√£o r√°pida): R$ 5.000 - R$ 8.000\n- Fraude banc√°ria (demora): R$ 10.000 - R$ 20.000\n- Plano sa√∫de - negativa: R$ 10.000 - R$ 30.000\n\n### ESTRUTURA\nI - RELAT√ìRIO\nII - FUNDAMENTA√á√ÉO (Rela√ß√£o de consumo, Responsabilidade Objetiva, Dano Moral)\nIII - DISPOSITIVO\n\nMarque com [REVISAR] qualquer ponto que necessite verifica√ß√£o."
        }
      },
      "id": "agent-consumidor",
      "name": "AI Agent: Consumidor",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 180]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\nGere a minuta completa seguindo a estrutura definida para A√á√ïES POSSESS√ìRIAS.",
        "options": {
          "systemMessage": "# AGENTE ESPECIALIZADO: A√á√ïES POSSESS√ìRIAS\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial especializado em a√ß√µes possess√≥rias e direitos reais. Gera minutas de decis√µes (liminares) e senten√ßas em reintegra√ß√£o, manuten√ß√£o de posse, interditos e usucapi√£o.\n\n### COMPET√äNCIAS\n- Reintegra√ß√£o de posse (Art. 560-566 CPC)\n- Manuten√ß√£o de posse\n- Interdito proibit√≥rio\n- Usucapi√£o (todas modalidades)\n- Imiss√£o na posse\n- Nuncia√ß√£o de obra nova\n\n### REQUISITOS LEGAIS\n\n**Reintegra√ß√£o de Posse (Art. 561 CPC):**\nI - Posse anterior\nII - Esbulho praticado pelo r√©u\nIII - Data do esbulho\nIV - Perda da posse\nLIMINAR: For√ßa nova (menos de ano e dia)\n\n**Manuten√ß√£o de Posse (Art. 560 CPC):**\nI - Sua posse\nII - Turba√ß√£o praticada pelo r√©u\nIII - Data da turba√ß√£o\nIV - Continua√ß√£o na posse\n\n### USUCAPI√ÉO - PRAZOS\n- Extraordin√°ria: 15 anos (ou 10 com moradia)\n- Ordin√°ria: 10 anos (ou 5 com registro)\n- Especial urbana: 5 anos (at√© 250m¬≤)\n- Especial rural: 5 anos (at√© 50ha)\n- Familiar: 2 anos\n\n### OBSERVA√á√ïES IMPORTANTES\n1. Car√°ter d√∫plice (art. 556 CPC)\n2. Audi√™ncia de justifica√ß√£o obrigat√≥ria se n√£o concedida liminar\n3. Conflitos coletivos: intimar MP e Defensoria\n\nMarque com [REVISAR] qualquer ponto incerto."
        }
      },
      "id": "agent-possessorias",
      "name": "AI Agent: Possess√≥rias",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 300]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\nGere a minuta completa seguindo a estrutura definida para A√á√ïES LOCAT√çCIAS.",
        "options": {
          "systemMessage": "# AGENTE ESPECIALIZADO: LOCA√á√ÉO DE IM√ìVEIS\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial especializado em a√ß√µes locat√≠cias regidas pela Lei 8.245/91 (Lei do Inquilinato).\n\n### COMPET√äNCIAS\n- Despejo por falta de pagamento\n- Despejo por den√∫ncia vazia\n- Despejo por infra√ß√£o contratual\n- A√ß√£o renovat√≥ria\n- A√ß√£o revisional de aluguel\n- Consignat√≥ria de alugu√©is\n\n### LEI 8.245/91 - DISPOSITIVOS CHAVE\n\n**Despejo por Falta de Pagamento (Art. 62):**\n- Purga√ß√£o da mora at√© a contesta√ß√£o\n- Veda√ß√£o se j√° usou nos √∫ltimos 24 meses\n- Prazo de 15 dias para desocupa√ß√£o (com cau√ß√£o de 3 meses)\n\n**Den√∫ncia Vazia:**\n- Art. 46: Contrato ‚â• 30 meses - cabe ap√≥s o prazo\n- Art. 47: Contrato < 30 meses - hip√≥teses taxativas\n\n**A√ß√£o Renovat√≥ria (Art. 51):**\nRequisitos CUMULATIVOS:\nI - Contrato escrito e prazo determinado\nII - Prazo m√≠nimo de 5 anos\nIII - Mesmo ramo por 3 anos\nIV - Prazo decadencial (1 ano a 6 meses antes)\n\n### OBSERVA√á√ïES\n1. Purga√ß√£o da mora: direito potestativo limitado\n2. Liminar de despejo: s√≥ nas hip√≥teses do art. 59, ¬ß1¬∫\n3. Cau√ß√£o para desocupa√ß√£o em 15 dias: 3 alugu√©is\n\nMarque com [REVISAR] qualquer ponto incerto."
        }
      },
      "id": "agent-locacao",
      "name": "AI Agent: Loca√ß√£o",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 420]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\nGere a minuta completa seguindo a estrutura definida para EXECU√á√ïES.",
        "options": {
          "systemMessage": "# AGENTE ESPECIALIZADO: EXECU√á√ïES E CUMPRIMENTO DE SENTEN√áA\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial especializado em processos executivos.\n\n### COMPET√äNCIAS\n- Execu√ß√£o de t√≠tulo extrajudicial (art. 784 CPC)\n- Cumprimento de senten√ßa (art. 523 CPC)\n- Embargos √† execu√ß√£o (art. 914 CPC)\n- Impugna√ß√£o ao cumprimento (art. 525 CPC)\n- Exce√ß√£o de pr√©-executividade\n- Prescri√ß√£o intercorrente (art. 921, ¬ß4¬∫)\n\n### T√çTULOS EXECUTIVOS EXTRAJUDICIAIS (Art. 784 CPC)\nI - Letra de c√¢mbio, nota promiss√≥ria, duplicata, cheque\nII - Escritura p√∫blica ou documento particular com 2 testemunhas\nIII - Instrumento de transa√ß√£o\nIV - Instrumento de confiss√£o de d√≠vida\nV - Contrato garantido por penhor, anticrese ou hipoteca\nVIII - Cr√©dito de aluguel\nIX - CDA\n\n### REQUISITOS DO T√çTULO (Art. 786 CPC)\n1. Certeza - Exist√™ncia definida\n2. Liquidez - Valor determinado\n3. Exigibilidade - Obriga√ß√£o vencida\n\n### PRESCRI√á√ÉO INTERCORRENTE (Art. 921, ¬ß4¬∫ CPC)\n- Suspens√£o por 1 ano + prazo prescricional\n- Cheque: ~18 meses total\n- Nota promiss√≥ria/duplicata: ~4 anos total\n\n### REGRAS ESPECIAIS\n1. Efeito suspensivo: requer pedido (art. 919 CPC)\n2. Honor√°rios cumulativos: conhecimento + cumprimento\n3. Prescri√ß√£o intercorrente: pode ser de of√≠cio\n\nMarque com [REVISAR] qualquer ponto incerto."
        }
      },
      "id": "agent-execucao",
      "name": "AI Agent: Execu√ß√£o",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 540]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "=Analise o seguinte processo e gere a minuta de decis√£o/senten√ßa apropriada:\n\n---\nFIRAC ANALYSIS:\n{{ JSON.stringify($json.firac_input, null, 2) }}\n---\n\nConfid√™ncia da classifica√ß√£o: {{ $json.router_result.confianca }}\n\n‚ö†Ô∏è ATEN√á√ÉO: Este caso foi classificado como GEN√âRICO devido √† baixa confian√ßa ou tipo de a√ß√£o n√£o mapeado. Gere a minuta com MAIS marcadores [REVISAR] do que o normal.",
        "options": {
          "systemMessage": "# AGENTE GEN√âRICO - FALLBACK\n## Vara C√≠vel - Tribunal de Justi√ßa do Esp√≠rito Santo\n\n### PAPEL\nVoc√™ √© um agente judicial generalista para a√ß√µes c√≠veis que n√£o se enquadram nas especializa√ß√µes definidas.\n\n### QUANDO ACIONADO\n- Classifica√ß√£o com confian√ßa < 50%\n- Tipos de a√ß√£o n√£o mapeados\n- Casos h√≠bridos ou at√≠picos\n\n### ESTRUTURA PADR√ÉO\n\nSENTEN√áA / DECIS√ÉO\n\nI - RELAT√ìRIO\n[S√≠ntese objetiva e imparcial]\n\nII - FUNDAMENTA√á√ÉO\n[An√°lise das quest√µes de direito]\n[Aplica√ß√£o da legisla√ß√£o pertinente]\n[Jurisprud√™ncia quando dispon√≠vel]\n\nIII - DISPOSITIVO\n[Decis√£o clara e objetiva]\n[Consequ√™ncias processuais]\n\n### MARCADORES OBRIGAT√ìRIOS\n\nUse ABUNDANTEMENTE os seguintes marcadores:\n- [REVISAR: fundamenta√ß√£o] - Base legal incerta\n- [REVISAR: valores] - Quantifica√ß√£o a verificar\n- [REVISAR: jurisprud√™ncia] - Precedentes a confirmar\n- [REVISAR: fatos] - Fatos n√£o claros no FIRAC\n- [REVISAR: classifica√ß√£o] - Tipo de a√ß√£o a reavaliar\n\n### OUTPUT\nGere minuta completa com MUITOS marcadores de revis√£o. PRIORIZE SEGURAN√áA sobre automa√ß√£o nestes casos."
        }
      },
      "id": "agent-generico",
      "name": "AI Agent: Gen√©rico",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1220, 660]
    },
    {
      "parameters": {},
      "id": "merge-agentes",
      "name": "Merge: Coleta Minutas",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1500, 340]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// QA CHECK - Valida√ß√£o de Minutas\n// CNJ 615/2025 Compliance\n// =============================================================================\n\nconst input = $input.first().json;\nconst minuta = input.output || input.text || '';\nconst routerResult = input.router_result || {};\n\n// =============================================================================\n// CHECKLIST DE VALIDA√á√ÉO\n// =============================================================================\n\nconst validacoes = [];\n\n// 1. Estrutura b√°sica\nconst temRelatorio = /I\\s*[-‚Äì]\\s*RELAT[√ìO]RIO/i.test(minuta);\nconst temFundamentacao = /II\\s*[-‚Äì]\\s*FUNDAMENTA[√áC][√ÉA]O/i.test(minuta);\nconst temDispositivo = /III\\s*[-‚Äì]\\s*DISPOSITIVO/i.test(minuta);\n\nvalidacoes.push({\n  item: 'Estrutura RELAT√ìRIO',\n  status: temRelatorio ? 'OK' : 'FALHA',\n  critico: true\n});\n\nvalidacoes.push({\n  item: 'Estrutura FUNDAMENTA√á√ÉO',\n  status: temFundamentacao ? 'OK' : 'FALHA',\n  critico: true\n});\n\nvalidacoes.push({\n  item: 'Estrutura DISPOSITIVO',\n  status: temDispositivo ? 'OK' : 'FALHA',\n  critico: true\n});\n\n// 2. Dispositivo\nconst temJulgamento = /JULGO\\s+(PROCEDENTE|IMPROCEDENTE|PARCIALMENTE)/i.test(minuta);\nvalidacoes.push({\n  item: 'Dispositivo com julgamento',\n  status: temJulgamento ? 'OK' : 'ALERTA',\n  critico: false\n});\n\n// 3. Sucumb√™ncia\nconst temSucumbencia = /honor[a√°]rios|custas/i.test(minuta);\nvalidacoes.push({\n  item: 'Sucumb√™ncia mencionada',\n  status: temSucumbencia ? 'OK' : 'ALERTA',\n  critico: false\n});\n\n// 4. Marcadores de revis√£o\nconst marcadoresRevisar = (minuta.match(/\\[REVISAR[:\\s]/gi) || []).length;\nvalidacoes.push({\n  item: 'Marcadores [REVISAR]',\n  status: marcadoresRevisar > 0 ? 'INFO' : 'OK',\n  valor: marcadoresRevisar,\n  critico: false\n});\n\n// 5. Tamanho m√≠nimo\nconst palavras = minuta.split(/\\s+/).length;\nvalidacoes.push({\n  item: 'Tamanho da minuta',\n  status: palavras > 100 ? 'OK' : 'ALERTA',\n  valor: palavras + ' palavras',\n  critico: false\n});\n\n// 6. Compliance CNJ 615/2025\nvalidacoes.push({\n  item: 'Supervis√£o humana obrigat√≥ria',\n  status: 'PENDENTE',\n  nota: 'Requer revis√£o do magistrado',\n  critico: true\n});\n\n// =============================================================================\n// C√ÅLCULO DO SCORE\n// =============================================================================\n\nconst falhasCriticas = validacoes.filter(v => v.critico && v.status === 'FALHA').length;\nconst alertas = validacoes.filter(v => v.status === 'ALERTA').length;\nconst totalOK = validacoes.filter(v => v.status === 'OK').length;\n\nlet scoreQA = 1.0;\nscoreQA -= falhasCriticas * 0.3;  // -30% por falha cr√≠tica\nscoreQA -= alertas * 0.1;          // -10% por alerta\nscoreQA = Math.max(0, Math.min(1, scoreQA));\n\nconst classificacaoRisco = routerResult.confianca < 0.5 ? 'ALTO' : \n                           routerResult.confianca < 0.75 ? 'MEDIO' : 'BAIXO';\n\n// =============================================================================\n// OUTPUT\n// =============================================================================\n\nreturn [{\n  json: {\n    minuta_gerada: minuta,\n    \n    qa_result: {\n      score: Math.round(scoreQA * 100) / 100,\n      aprovado: scoreQA >= 0.7 && falhasCriticas === 0,\n      validacoes: validacoes,\n      falhas_criticas: falhasCriticas,\n      alertas: alertas,\n      marcadores_revisar: marcadoresRevisar\n    },\n    \n    compliance_cnj615: {\n      classificacao_risco: classificacaoRisco,\n      requer_revisao_humana: true,\n      revisao_realizada: false,\n      agente_utilizado: routerResult.agente_selecionado || 'desconhecido',\n      confianca_classificacao: routerResult.confianca || 0\n    },\n    \n    metadata: {\n      timestamp: new Date().toISOString(),\n      versao_sistema: '2.0',\n      palavras_minuta: palavras\n    }\n  }\n}];"
      },
      "id": "qa-check",
      "name": "Code: QA Check",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1720, 340]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// AUDIT LOG - CNJ 615/2025\n// =============================================================================\n\nconst data = $input.first().json;\n\nconst auditLog = {\n  timestamp: new Date().toISOString(),\n  \n  // Sistema\n  sistema: 'Lex Intelligentia Judici√°rio',\n  versao: '2.0',\n  \n  // Opera√ß√£o\n  operacao: 'GERACAO_MINUTA',\n  agente: data.compliance_cnj615?.agente_utilizado || 'desconhecido',\n  \n  // Classifica√ß√£o de Risco CNJ 615\n  classificacao_risco: data.compliance_cnj615?.classificacao_risco || 'ALTO',\n  confianca_classificacao: data.compliance_cnj615?.confianca_classificacao || 0,\n  \n  // QA\n  score_qa: data.qa_result?.score || 0,\n  qa_aprovado: data.qa_result?.aprovado || false,\n  falhas_criticas: data.qa_result?.falhas_criticas || 0,\n  marcadores_revisao: data.qa_result?.marcadores_revisar || 0,\n  \n  // Compliance\n  requer_revisao_humana: true,\n  revisao_realizada: false,\n  \n  // M√©tricas\n  palavras_minuta: data.metadata?.palavras_minuta || 0,\n  \n  // Hashes para auditoria\n  hash_input: require('crypto').createHash('md5')\n    .update(JSON.stringify(data.firac_input || {}))\n    .digest('hex'),\n  hash_output: require('crypto').createHash('md5')\n    .update(data.minuta_gerada || '')\n    .digest('hex')\n};\n\nconsole.log('AUDIT LOG CNJ 615:', JSON.stringify(auditLog));\n\n// Adicionar ao output\nreturn [{\n  json: {\n    ...data,\n    audit_log: auditLog\n  }\n}];"
      },
      "id": "audit-log",
      "name": "Code: Audit Log CNJ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1940, 340]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": true,\n  \"minuta\": {{ JSON.stringify($json.minuta_gerada) }},\n  \"qa\": {\n    \"score\": {{ $json.qa_result.score }},\n    \"aprovado\": {{ $json.qa_result.aprovado }},\n    \"marcadores_revisar\": {{ $json.qa_result.marcadores_revisar }}\n  },\n  \"compliance\": {\n    \"risco\": \"{{ $json.compliance_cnj615.classificacao_risco }}\",\n    \"agente\": \"{{ $json.compliance_cnj615.agente_utilizado }}\",\n    \"confianca\": {{ $json.compliance_cnj615.confianca_classificacao }}\n  },\n  \"audit_id\": \"{{ $json.audit_log.hash_output }}\",\n  \"timestamp\": \"{{ $json.metadata.timestamp }}\"\n}",
        "options": {}
      },
      "id": "respond-final",
      "name": "Respond: Output Final",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [2160, 340]
    },
    {
      "parameters": {
        "model": "claude-sonnet-4-20250514",
        "options": {
          "temperature": 0.3,
          "maxTokensToSample": 4000
        }
      },
      "id": "llm-anthropic",
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [1100, 800],
      "credentials": {
        "anthropicApi": {
          "id": "ANTHROPIC_CREDENTIALS_ID",
          "name": "Anthropic API"
        }
      }
    },
    {
      "parameters": {
        "content": "## ü§ñ AGENTES ESPECIALIZADOS\n\nCada agente possui:\n- System prompt espec√≠fico\n- Base jurisprudencial TJES/STJ\n- Tabelas de par√¢metros atualizadas\n- Estruturas de minuta padronizadas\n\n**Agentes:**\n1. Banc√°rio (35-40%)\n2. Consumidor (25-30%)\n3. Possess√≥rias (5-8%)\n4. Loca√ß√£o (8-12%)\n5. Execu√ß√£o (15-20%)\n6. Gen√©rico (~5%)",
        "height": 280,
        "width": 260
      },
      "id": "sticky-agentes",
      "name": "üìù AGENTES",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1200, 780]
    },
    {
      "parameters": {
        "content": "## ‚úÖ QA CHECK\n\nValida√ß√µes:\n- Estrutura (R/F/D)\n- Dispositivo completo\n- Sucumb√™ncia\n- Marcadores [REVISAR]\n- Score m√≠nimo: 0.7\n\n**CNJ 615/2025:**\n- Classifica√ß√£o de risco\n- Auditoria obrigat√≥ria\n- Supervis√£o humana",
        "height": 240,
        "width": 200
      },
      "id": "sticky-qa",
      "name": "‚úÖ VALIDA√á√ÉO",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1700, 520]
    }
  ],
  "connections": {
    "Webhook: Recebe FIRAC": {
      "main": [
        [
          {
            "node": "Code: Router Judici√°rio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: Router Judici√°rio": {
      "main": [
        [
          {
            "node": "Switch: Seleciona Agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch: Seleciona Agente": {
      "main": [
        [
          {
            "node": "AI Agent: Banc√°rio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent: Consumidor",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent: Possess√≥rias",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent: Loca√ß√£o",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent: Execu√ß√£o",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent: Gen√©rico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Banc√°rio": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Consumidor": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Possess√≥rias": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Loca√ß√£o": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Execu√ß√£o": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent: Gen√©rico": {
      "main": [
        [
          {
            "node": "Merge: Coleta Minutas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge: Coleta Minutas": {
      "main": [
        [
          {
            "node": "Code: QA Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: QA Check": {
      "main": [
        [
          {
            "node": "Code: Audit Log CNJ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: Audit Log CNJ": {
      "main": [
        [
          {
            "node": "Respond: Output Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent: Banc√°rio",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent: Consumidor",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent: Possess√≥rias",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent: Loca√ß√£o",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent: Execu√ß√£o",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent: Gen√©rico",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "Lex Intelligentia"
    },
    {
      "name": "Agentes"
    },
    {
      "name": "Judicial"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2026-01-14T00:00:00.000Z",
  "versionId": "2"
}
